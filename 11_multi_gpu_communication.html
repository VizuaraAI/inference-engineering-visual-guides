<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Multi-GPU Communication: NVLink, NVSwitch & InfiniBand</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'Inter',sans-serif;background:#0a0a0f;color:#e2e8f0;overflow-x:hidden;line-height:1.6}
::-webkit-scrollbar{width:6px}
::-webkit-scrollbar-track{background:#0a0a0f}
::-webkit-scrollbar-thumb{background:#6366f1;border-radius:3px}

.progress-bar{position:fixed;top:0;left:0;width:0%;height:3px;background:linear-gradient(90deg,#6366f1,#22d3ee);z-index:1000;transition:width .3s}
.nav-dots{position:fixed;right:20px;top:50%;transform:translateY(-50%);z-index:100;display:flex;flex-direction:column;gap:12px}
.nav-dot{width:10px;height:10px;border-radius:50%;background:#333;cursor:pointer;transition:all .3s;border:2px solid transparent}
.nav-dot.active{background:#6366f1;border-color:#22d3ee;transform:scale(1.3)}
.nav-dot:hover{background:#6366f1}

section{min-height:100vh;padding:80px 60px;display:flex;flex-direction:column;justify-content:center;align-items:center;position:relative}

.hero-section{background:radial-gradient(ellipse at center,#1a1a3e 0%,#0a0a0f 70%)}
.hero-title{font-size:3.2rem;font-weight:800;text-align:center;margin-bottom:20px;background:linear-gradient(135deg,#6366f1,#22d3ee);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.hero-subtitle{font-size:1.3rem;color:#94a3b8;text-align:center;max-width:700px;margin-bottom:40px}
.hero-badge{display:inline-flex;align-items:center;gap:8px;background:rgba(99,102,241,.15);border:1px solid rgba(99,102,241,.3);border-radius:20px;padding:8px 20px;font-size:.85rem;color:#a5b4fc;margin-bottom:20px}

.section-title{font-size:2rem;font-weight:700;margin-bottom:10px;text-align:center}
.section-desc{color:#94a3b8;text-align:center;max-width:600px;margin-bottom:40px}
.highlight{color:#22d3ee}
.highlight-amber{color:#f59e0b}
.highlight-green{color:#10b981}
.highlight-indigo{color:#a5b4fc}

/* GPU Node Diagram */
.node-container{position:relative;width:800px;height:500px;margin:0 auto}
.gpu-node{position:relative;width:700px;height:400px;border:2px solid #333;border-radius:20px;background:rgba(20,20,40,.6);margin:0 auto}
.gpu-node-label{position:absolute;top:-15px;left:30px;background:#0a0a0f;padding:0 10px;font-weight:600;color:#a5b4fc;font-size:.9rem}
.gpu-chip{position:absolute;width:70px;height:70px;border-radius:12px;background:linear-gradient(135deg,#1e1e3f,#2a2a5f);border:2px solid #444;cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:.75rem;font-weight:700;color:#a5b4fc;transition:all .3s;z-index:5}
.gpu-chip:hover{border-color:#6366f1;box-shadow:0 0 20px rgba(99,102,241,.4);transform:scale(1.08)}
.gpu-chip.active{border-color:#22d3ee;box-shadow:0 0 30px rgba(34,211,238,.5);background:linear-gradient(135deg,#1a2a4f,#1a3a5f)}
.nvswitch-chip{position:absolute;width:90px;height:50px;border-radius:10px;background:linear-gradient(135deg,#2a1a0f,#3a2a1f);border:2px solid #f59e0b;display:flex;align-items:center;justify-content:center;font-size:.65rem;font-weight:700;color:#f59e0b;z-index:5}

.connection-canvas{position:absolute;top:0;left:0;width:100%;height:100%;pointer-events:none;z-index:2}

.speed-label{position:absolute;font-size:.65rem;font-weight:600;padding:2px 8px;border-radius:10px;white-space:nowrap;z-index:10}

/* Data transfer animation */
.data-packet{position:absolute;width:8px;height:8px;border-radius:50%;background:#22d3ee;box-shadow:0 0 10px #22d3ee;z-index:8;opacity:0}

/* Multi-node */
.multi-node-container{display:flex;gap:60px;align-items:center;position:relative}
.mini-node{width:300px;height:200px;border:2px solid #333;border-radius:15px;background:rgba(20,20,40,.6);position:relative;padding:20px}
.mini-node-label{font-size:.8rem;font-weight:600;color:#a5b4fc;margin-bottom:10px}
.mini-gpu-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:8px}
.mini-gpu{width:50px;height:35px;border-radius:6px;background:linear-gradient(135deg,#1e1e3f,#2a2a5f);border:1px solid #444;display:flex;align-items:center;justify-content:center;font-size:.55rem;font-weight:700;color:#a5b4fc}
.ib-connection{display:flex;flex-direction:column;align-items:center;gap:5px}
.ib-line{width:80px;height:4px;background:linear-gradient(90deg,#f59e0b,#22d3ee,#f59e0b);border-radius:2px;position:relative;overflow:hidden}
.ib-line::after{content:'';position:absolute;top:0;left:-100%;width:50%;height:100%;background:linear-gradient(90deg,transparent,#fff,transparent);animation:ibFlow 1.5s infinite}
@keyframes ibFlow{to{left:200%}}
.ib-label{font-size:.7rem;font-weight:600;color:#f59e0b}

/* Bandwidth comparison */
.bw-chart{display:flex;gap:30px;align-items:flex-end;height:300px;padding:20px}
.bw-bar-container{display:flex;flex-direction:column;align-items:center;gap:10px}
.bw-bar{width:80px;border-radius:8px 8px 0 0;transition:height 1.5s cubic-bezier(.4,0,.2,1);position:relative;display:flex;align-items:flex-start;justify-content:center;padding-top:10px}
.bw-bar-value{font-size:.8rem;font-weight:700;color:#fff}
.bw-bar-label{font-size:.75rem;font-weight:600;text-align:center;color:#94a3b8;max-width:100px}

/* Bandwidth cliff */
.cliff-container{position:relative;width:700px;height:250px;margin:30px auto}
.cliff-visual{display:flex;align-items:flex-end;height:200px;gap:0;padding:0 40px}
.cliff-segment{display:flex;flex-direction:column;align-items:center;transition:all 1s}
.cliff-bar{border-radius:6px 6px 0 0;transition:height 1.5s cubic-bezier(.4,0,.2,1)}
.cliff-label{font-size:.7rem;margin-top:8px;color:#94a3b8;text-align:center}
.cliff-arrow{position:absolute;color:#f59e0b;font-weight:700;font-size:.85rem}
.cliff-divider{width:2px;height:200px;background:repeating-linear-gradient(to bottom,#f59e0b 0,#f59e0b 5px,transparent 5px,transparent 10px);position:relative}

.card{background:rgba(20,20,40,.6);border:1px solid #222;border-radius:16px;padding:30px;transition:all .3s}
.card:hover{border-color:#6366f1;box-shadow:0 4px 30px rgba(99,102,241,.1)}
.info-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:20px;max-width:900px}

@keyframes fadeInUp{from{opacity:0;transform:translateY(30px)}to{opacity:1;transform:translateY(0)}}
@keyframes pulse{0%,100%{opacity:.6}50%{opacity:1}}
.animate-in{animation:fadeInUp .8s ease both}
.animate-delay-1{animation-delay:.2s}
.animate-delay-2{animation-delay:.4s}
.animate-delay-3{animation-delay:.6s}

@keyframes gradientShift{0%{background-position:0% 50%}50%{background-position:100% 50%}100%{background-position:0% 50%}}
.gradient-bg{background:linear-gradient(135deg,#0a0a1f,#0f0f2f,#0a0a1f);background-size:200% 200%;animation:gradientShift 8s ease infinite}
</style>
</head>
<body>
<div class="progress-bar" id="progressBar"></div>
<nav class="nav-dots" id="navDots"></nav>

<!-- Section 1: Hero -->
<section class="hero-section" id="sec0">
<div class="hero-badge">Chapter 11 -- Hardware Communication</div>
<h1 class="hero-title">Multi-GPU Communication</h1>
<p class="hero-subtitle">NVLink, NVSwitch & InfiniBand -- the interconnect fabric that makes large-scale inference possible at 900 GB/s and beyond.</p>
<div style="display:flex;gap:20px;margin-top:20px">
<div class="card" style="text-align:center;padding:20px 30px">
<div style="font-size:2rem;font-weight:800;color:#6366f1">900 GB/s</div>
<div style="font-size:.8rem;color:#94a3b8">NVLink Bandwidth</div>
</div>
<div class="card" style="text-align:center;padding:20px 30px">
<div style="font-size:2rem;font-weight:800;color:#22d3ee">400 Gb/s</div>
<div style="font-size:.8rem;color:#94a3b8">InfiniBand Link</div>
</div>
<div class="card" style="text-align:center;padding:20px 30px">
<div style="font-size:2rem;font-weight:800;color:#f59e0b">18x</div>
<div style="font-size:.8rem;color:#94a3b8">NVLink vs InfiniBand</div>
</div>
</div>
</section>

<!-- Section 2: 8-GPU Node -->
<section class="gradient-bg" id="sec1">
<h2 class="section-title">8-GPU Node with <span class="highlight">NVLink</span></h2>
<p class="section-desc">Click any GPU to see its NVLink connections light up. Each link delivers <span class="highlight">900 GB/s</span> bidirectional bandwidth.</p>
<div class="gpu-node" id="gpuNode">
<div class="gpu-node-label">DGX / HGX Node -- 8x H100 GPUs</div>
<canvas class="connection-canvas" id="connCanvas" width="700" height="400"></canvas>
<div class="gpu-chip" id="gpu0" style="top:30px;left:80px" onclick="selectGpu(0)">GPU 0</div>
<div class="gpu-chip" id="gpu1" style="top:30px;left:220px" onclick="selectGpu(1)">GPU 1</div>
<div class="gpu-chip" id="gpu2" style="top:30px;left:360px" onclick="selectGpu(2)">GPU 2</div>
<div class="gpu-chip" id="gpu3" style="top:30px;left:500px" onclick="selectGpu(3)">GPU 3</div>
<div class="gpu-chip" id="gpu4" style="top:280px;left:80px" onclick="selectGpu(4)">GPU 4</div>
<div class="gpu-chip" id="gpu5" style="top:280px;left:220px" onclick="selectGpu(5)">GPU 5</div>
<div class="gpu-chip" id="gpu6" style="top:280px;left:360px" onclick="selectGpu(6)">GPU 6</div>
<div class="gpu-chip" id="gpu7" style="top:280px;left:500px" onclick="selectGpu(7)">GPU 7</div>
<div class="nvswitch-chip" style="top:165px;left:180px">NVSwitch 1</div>
<div class="nvswitch-chip" style="top:165px;left:400px">NVSwitch 2</div>
</div>
<p style="font-size:.8rem;color:#64748b;margin-top:15px">NVSwitch provides all-to-all connectivity -- every GPU can communicate with every other GPU at full bandwidth.</p>
</section>

<!-- Section 3: NVSwitch -->
<section id="sec2">
<h2 class="section-title">NVSwitch: <span class="highlight-amber">All-to-All</span> Coordination</h2>
<p class="section-desc">NVSwitch eliminates the need for multi-hop transfers. Any GPU reaches any GPU in one hop at full 900 GB/s.</p>
<div style="display:flex;gap:40px;flex-wrap:wrap;justify-content:center;margin-top:20px">
<div class="card animate-in" style="max-width:350px">
<h3 style="color:#f59e0b;margin-bottom:10px;font-size:1.1rem">Without NVSwitch</h3>
<p style="font-size:.85rem;color:#94a3b8;margin-bottom:15px">GPUs connected in a ring or mesh. Multi-hop required for non-adjacent GPUs. Bandwidth halved per hop.</p>
<div style="text-align:center;padding:15px;background:rgba(245,158,11,.05);border-radius:10px;border:1px solid rgba(245,158,11,.2)">
<div style="font-size:.8rem;color:#f59e0b">GPU0 -> GPU1 -> GPU5</div>
<div style="font-size:.75rem;color:#94a3b8;margin-top:5px">2 hops = ~450 GB/s effective</div>
</div>
</div>
<div class="card animate-in animate-delay-1" style="max-width:350px">
<h3 style="color:#10b981;margin-bottom:10px;font-size:1.1rem">With NVSwitch</h3>
<p style="font-size:.85rem;color:#94a3b8;margin-bottom:15px">All-to-all fabric. Every GPU pair has a direct path. Full bandwidth regardless of which GPUs communicate.</p>
<div style="text-align:center;padding:15px;background:rgba(16,185,129,.05);border-radius:10px;border:1px solid rgba(16,185,129,.2)">
<div style="font-size:.8rem;color:#10b981">GPU0 -> NVSwitch -> GPU5</div>
<div style="font-size:.75rem;color:#94a3b8;margin-top:5px">1 hop = 900 GB/s full speed</div>
</div>
</div>
</div>
<div style="margin-top:30px;text-align:center">
<button id="animateTransfer" onclick="animateDataTransfer()" style="padding:12px 30px;border:none;border-radius:10px;background:linear-gradient(135deg,#6366f1,#4f46e5);color:#fff;font-weight:600;cursor:pointer;font-size:.9rem;transition:all .3s">Animate Data Transfer</button>
</div>
<canvas id="transferCanvas" width="700" height="200" style="margin-top:20px;border-radius:10px"></canvas>
</section>

<!-- Section 4: Multi-Node -->
<section class="gradient-bg" id="sec3">
<h2 class="section-title">Multi-Node: <span class="highlight">InfiniBand</span> Between Nodes</h2>
<p class="section-desc">When one node isn't enough, InfiniBand connects multiple 8-GPU nodes at 400 Gb/s per link.</p>
<div class="multi-node-container">
<div class="mini-node">
<div class="mini-node-label">Node 1 -- 8x H100</div>
<div class="mini-gpu-grid">
<div class="mini-gpu">G0</div><div class="mini-gpu">G1</div><div class="mini-gpu">G2</div><div class="mini-gpu">G3</div>
<div class="mini-gpu">G4</div><div class="mini-gpu">G5</div><div class="mini-gpu">G6</div><div class="mini-gpu">G7</div>
</div>
<div style="margin-top:12px;font-size:.7rem;color:#6366f1;text-align:center">Intra-node: 900 GB/s NVLink</div>
</div>
<div class="ib-connection">
<div class="ib-label">InfiniBand NDR</div>
<div class="ib-line"></div>
<div class="ib-line"></div>
<div class="ib-line"></div>
<div class="ib-line"></div>
<div style="font-size:.65rem;color:#f59e0b;font-weight:600">400 Gb/s x 8 links</div>
<div style="font-size:.6rem;color:#94a3b8">= 50 GB/s per link</div>
</div>
<div class="mini-node">
<div class="mini-node-label">Node 2 -- 8x H100</div>
<div class="mini-gpu-grid">
<div class="mini-gpu">G0</div><div class="mini-gpu">G1</div><div class="mini-gpu">G2</div><div class="mini-gpu">G3</div>
<div class="mini-gpu">G4</div><div class="mini-gpu">G5</div><div class="mini-gpu">G6</div><div class="mini-gpu">G7</div>
</div>
<div style="margin-top:12px;font-size:.7rem;color:#6366f1;text-align:center">Intra-node: 900 GB/s NVLink</div>
</div>
</div>
<div class="card" style="margin-top:30px;max-width:500px;text-align:center">
<p style="font-size:.85rem;color:#94a3b8">Each GPU in Node 1 has a dedicated IB link to the corresponding GPU in Node 2. Total inter-node bandwidth: <span class="highlight-amber">400 GB/s</span> (8 links x 50 GB/s).</p>
</div>
</section>

<!-- Section 5: Bandwidth Comparison -->
<section id="sec4">
<h2 class="section-title">Bandwidth <span class="highlight">Comparison</span></h2>
<p class="section-desc">How do these interconnects stack up? The differences are massive.</p>
<div class="bw-chart" id="bwChart">
<div class="bw-bar-container">
<div class="bw-bar" id="bar0" style="height:0;background:linear-gradient(180deg,#6366f1,#4f46e5)">
<span class="bw-bar-value">900</span>
</div>
<div class="bw-bar-label">NVLink<br>(GB/s)</div>
</div>
<div class="bw-bar-container">
<div class="bw-bar" id="bar1" style="height:0;background:linear-gradient(180deg,#f59e0b,#d97706)">
<span class="bw-bar-value">400</span>
</div>
<div class="bw-bar-label">IB Total<br>(GB/s)</div>
</div>
<div class="bw-bar-container">
<div class="bw-bar" id="bar2" style="height:0;background:linear-gradient(180deg,#22d3ee,#0891b2)">
<span class="bw-bar-value">50</span>
</div>
<div class="bw-bar-label">IB per Link<br>(GB/s)</div>
</div>
<div class="bw-bar-container">
<div class="bw-bar" id="bar3" style="height:0;background:linear-gradient(180deg,#64748b,#475569)">
<span class="bw-bar-value">64</span>
</div>
<div class="bw-bar-label">PCIe 5.0<br>(GB/s)</div>
</div>
<div class="bw-bar-container">
<div class="bw-bar" id="bar4" style="height:0;background:linear-gradient(180deg,#334155,#1e293b)">
<span class="bw-bar-value">25</span>
</div>
<div class="bw-bar-label">Ethernet<br>100GbE(GB/s)</div>
</div>
</div>
</section>

<!-- Section 6: Bandwidth Cliff -->
<section class="gradient-bg" id="sec5">
<h2 class="section-title">The <span class="highlight-amber">Bandwidth Cliff</span></h2>
<p class="section-desc">Moving data between nodes is 18x slower than within a node. This cliff shapes every distributed inference decision.</p>
<div class="cliff-container">
<div style="display:flex;align-items:flex-end;gap:20px;justify-content:center;height:250px">
<div style="text-align:center">
<div id="cliffBar1" style="width:120px;height:0;background:linear-gradient(180deg,#6366f1,#4f46e5);border-radius:8px 8px 0 0;transition:height 1.5s;display:flex;align-items:flex-start;justify-content:center;padding-top:10px">
<span style="font-weight:700;color:#fff;font-size:.9rem">900 GB/s</span>
</div>
<div style="margin-top:8px;font-size:.8rem;color:#a5b4fc;font-weight:600">Intra-Node<br>(NVLink)</div>
</div>
<div style="display:flex;flex-direction:column;align-items:center;justify-content:flex-end;height:250px">
<div style="font-size:1.5rem;font-weight:800;color:#f59e0b;margin-bottom:10px">18x gap!</div>
<svg width="60" height="80"><path d="M30 0 L50 30 L40 30 L40 80 L20 80 L20 30 L10 30 Z" fill="#f59e0b" opacity=".3"/></svg>
</div>
<div style="text-align:center">
<div id="cliffBar2" style="width:120px;height:0;background:linear-gradient(180deg,#f59e0b,#d97706);border-radius:8px 8px 0 0;transition:height 1.5s;display:flex;align-items:flex-start;justify-content:center;padding-top:10px">
<span style="font-weight:700;color:#fff;font-size:.9rem">50 GB/s</span>
</div>
<div style="margin-top:8px;font-size:.8rem;color:#fbbf24;font-weight:600">Inter-Node<br>(InfiniBand)</div>
</div>
</div>
</div>
<div class="info-grid" style="margin-top:20px">
<div class="card">
<h4 style="color:#6366f1;margin-bottom:8px">Implication: Tensor Parallelism</h4>
<p style="font-size:.8rem;color:#94a3b8">TP requires high bandwidth for all-reduce operations every layer. Keep TP <span class="highlight">within a single node</span> (TP <= 8).</p>
</div>
<div class="card">
<h4 style="color:#f59e0b;margin-bottom:8px">Implication: Pipeline Parallelism</h4>
<p style="font-size:.8rem;color:#94a3b8">PP only sends activations between stages. Tolerates lower bandwidth. Use PP <span class="highlight-amber">across nodes</span>.</p>
</div>
</div>
</section>

<!-- Section 7: Speed Table -->
<section id="sec6">
<h2 class="section-title">Interconnect <span class="highlight-green">Quick Reference</span></h2>
<p class="section-desc">All the numbers you need, in one place.</p>
<div style="max-width:700px;width:100%">
<table style="width:100%;border-collapse:collapse;font-size:.85rem">
<thead>
<tr style="border-bottom:2px solid #333">
<th style="padding:12px;text-align:left;color:#a5b4fc">Interconnect</th>
<th style="padding:12px;text-align:center;color:#a5b4fc">Bandwidth</th>
<th style="padding:12px;text-align:center;color:#a5b4fc">Scope</th>
<th style="padding:12px;text-align:center;color:#a5b4fc">Use Case</th>
</tr>
</thead>
<tbody>
<tr style="border-bottom:1px solid #1e1e3f;transition:background .3s" onmouseover="this.style.background='rgba(99,102,241,.05)'" onmouseout="this.style.background='transparent'">
<td style="padding:12px;color:#6366f1;font-weight:600">NVLink 4.0</td>
<td style="padding:12px;text-align:center;font-weight:700;color:#22d3ee">900 GB/s</td>
<td style="padding:12px;text-align:center;color:#94a3b8">GPU-to-GPU</td>
<td style="padding:12px;text-align:center;color:#94a3b8">Tensor Parallel</td>
</tr>
<tr style="border-bottom:1px solid #1e1e3f;transition:background .3s" onmouseover="this.style.background='rgba(99,102,241,.05)'" onmouseout="this.style.background='transparent'">
<td style="padding:12px;color:#f59e0b;font-weight:600">NVLink-C2C</td>
<td style="padding:12px;text-align:center;font-weight:700;color:#22d3ee">900 GB/s</td>
<td style="padding:12px;text-align:center;color:#94a3b8">CPU-GPU</td>
<td style="padding:12px;text-align:center;color:#94a3b8">KV Cache Offload</td>
</tr>
<tr style="border-bottom:1px solid #1e1e3f;transition:background .3s" onmouseover="this.style.background='rgba(99,102,241,.05)'" onmouseout="this.style.background='transparent'">
<td style="padding:12px;color:#f59e0b;font-weight:600">InfiniBand NDR</td>
<td style="padding:12px;text-align:center;font-weight:700;color:#22d3ee">400 Gb/s</td>
<td style="padding:12px;text-align:center;color:#94a3b8">Node-to-Node</td>
<td style="padding:12px;text-align:center;color:#94a3b8">Pipeline Parallel</td>
</tr>
<tr style="border-bottom:1px solid #1e1e3f;transition:background .3s" onmouseover="this.style.background='rgba(99,102,241,.05)'" onmouseout="this.style.background='transparent'">
<td style="padding:12px;color:#64748b;font-weight:600">PCIe Gen 5</td>
<td style="padding:12px;text-align:center;font-weight:700;color:#22d3ee">64 GB/s</td>
<td style="padding:12px;text-align:center;color:#94a3b8">CPU-GPU</td>
<td style="padding:12px;text-align:center;color:#94a3b8">Data Loading</td>
</tr>
<tr style="transition:background .3s" onmouseover="this.style.background='rgba(99,102,241,.05)'" onmouseout="this.style.background='transparent'">
<td style="padding:12px;color:#64748b;font-weight:600">Ethernet 100GbE</td>
<td style="padding:12px;text-align:center;font-weight:700;color:#22d3ee">12.5 GB/s</td>
<td style="padding:12px;text-align:center;color:#94a3b8">Network</td>
<td style="padding:12px;text-align:center;color:#94a3b8">General</td>
</tr>
</tbody>
</table>
</div>
</section>

<!-- Section 8: Key Takeaways -->
<section class="gradient-bg" id="sec7">
<h2 class="section-title">Key <span class="highlight-amber">Takeaways</span></h2>
<div class="info-grid" style="margin-top:20px">
<div class="card animate-in">
<div style="font-size:1.5rem;margin-bottom:10px">1</div>
<h4 style="color:#6366f1;margin-bottom:8px">NVLink Is King Inside a Node</h4>
<p style="font-size:.82rem;color:#94a3b8">900 GB/s bidirectional bandwidth means tensor parallelism across 8 GPUs within a node has near-zero communication overhead.</p>
</div>
<div class="card animate-in animate-delay-1">
<div style="font-size:1.5rem;margin-bottom:10px">2</div>
<h4 style="color:#f59e0b;margin-bottom:8px">InfiniBand Bridges the Gap</h4>
<p style="font-size:.82rem;color:#94a3b8">400 Gb/s per link (50 GB/s). With 8 links per node, you get 400 GB/s aggregate. Still 2.25x slower than NVLink.</p>
</div>
<div class="card animate-in animate-delay-2">
<div style="font-size:1.5rem;margin-bottom:10px">3</div>
<h4 style="color:#22d3ee;margin-bottom:8px">Design Around the Cliff</h4>
<p style="font-size:.82rem;color:#94a3b8">The 18x bandwidth drop between intra-node and inter-node defines the parallelism strategy: TP inside, PP outside.</p>
</div>
<div class="card animate-in animate-delay-3">
<div style="font-size:1.5rem;margin-bottom:10px">4</div>
<h4 style="color:#10b981;margin-bottom:8px">NVSwitch Enables All-to-All</h4>
<p style="font-size:.82rem;color:#94a3b8">Without NVSwitch, GPUs need multi-hop ring connections. With it, every GPU pair gets full bandwidth in a single hop.</p>
</div>
</div>
</section>

<script>
// GPU positions for canvas drawing
const gpuPositions = [
  {x:115,y:65},{x:255,y:65},{x:395,y:65},{x:535,y:65},
  {x:115,y:315},{x:255,y:315},{x:395,y:315},{x:535,y:315}
];
const switchPositions = [{x:225,y:190},{x:445,y:190}];

let activeGpu = -1;
const canvas = document.getElementById('connCanvas');
const ctx = canvas.getContext('2d');

function drawConnections() {
  ctx.clearRect(0,0,700,400);
  if(activeGpu < 0) return;

  for(let i=0;i<8;i++) {
    if(i === activeGpu) continue;
    const from = gpuPositions[activeGpu];
    const to = gpuPositions[i];
    // Draw through nvswitch
    const sw = switchPositions[i < 4 ? 0 : 1];

    ctx.beginPath();
    ctx.moveTo(from.x, from.y);
    ctx.quadraticCurveTo((from.x+to.x)/2, (from.y+to.y)/2, to.x, to.y);
    ctx.strokeStyle = 'rgba(34,211,238,0.3)';
    ctx.lineWidth = 2;
    ctx.stroke();

    // Animated dash
    ctx.beginPath();
    ctx.setLineDash([5,10]);
    ctx.lineDashOffset = -performance.now()/50;
    ctx.moveTo(from.x, from.y);
    ctx.quadraticCurveTo((from.x+to.x)/2, (from.y+to.y)/2, to.x, to.y);
    ctx.strokeStyle = '#22d3ee';
    ctx.lineWidth = 2;
    ctx.stroke();
    ctx.setLineDash([]);
  }
  requestAnimationFrame(drawConnections);
}

function selectGpu(idx) {
  document.querySelectorAll('.gpu-chip').forEach(g => g.classList.remove('active'));
  if(activeGpu === idx) { activeGpu = -1; ctx.clearRect(0,0,700,400); return; }
  activeGpu = idx;
  document.getElementById('gpu'+idx).classList.add('active');
  drawConnections();
}

// Data transfer animation
function animateDataTransfer() {
  const tc = document.getElementById('transferCanvas');
  const tctx = tc.getContext('2d');
  let t = 0;
  const gpus = [];
  for(let i=0;i<8;i++) gpus.push({x:50+i*85, y:80, label:'GPU '+i});

  function draw() {
    tctx.clearRect(0,0,700,200);
    // Draw GPUs
    gpus.forEach((g,i) => {
      tctx.fillStyle = i===0 ? '#6366f1' : (i===7 ? '#22d3ee' : '#2a2a5f');
      tctx.strokeStyle = i===0 ? '#6366f1' : (i===7 ? '#22d3ee' : '#444');
      tctx.lineWidth = 2;
      tctx.beginPath();
      tctx.roundRect(g.x-25,g.y-20,50,40,8);
      tctx.fill();
      tctx.stroke();
      tctx.fillStyle = '#e2e8f0';
      tctx.font = '11px Inter';
      tctx.textAlign = 'center';
      tctx.fillText(g.label, g.x, g.y+4);
    });

    // NVSwitch bar
    tctx.fillStyle = 'rgba(245,158,11,0.2)';
    tctx.strokeStyle = '#f59e0b';
    tctx.lineWidth = 1;
    tctx.beginPath();
    tctx.roundRect(30,130,640,30,6);
    tctx.fill();
    tctx.stroke();
    tctx.fillStyle = '#f59e0b';
    tctx.font = '600 11px Inter';
    tctx.textAlign = 'center';
    tctx.fillText('NVSwitch Fabric', 350, 150);

    // Animate data packet from GPU0 to GPU7
    const progress = (t % 200) / 200;
    const px = gpus[0].x + (gpus[7].x - gpus[0].x) * progress;
    const py = progress < 0.5 ? 80 + (progress*2)*65 : 145 - ((progress-0.5)*2)*65;

    tctx.beginPath();
    tctx.arc(px, py, 6, 0, Math.PI*2);
    tctx.fillStyle = '#22d3ee';
    tctx.fill();
    tctx.shadowColor = '#22d3ee';
    tctx.shadowBlur = 15;
    tctx.fill();
    tctx.shadowBlur = 0;

    // Speed label
    tctx.fillStyle = '#10b981';
    tctx.font = '700 12px Inter';
    tctx.fillText('900 GB/s via NVSwitch', 350, 30);

    t++;
    if(t < 400) requestAnimationFrame(draw);
  }
  draw();
}

// Bandwidth bars animation
const barHeights = [270, 120, 15, 19, 7];
const barEls = ['bar0','bar1','bar2','bar3','bar4'];

// Cliff bars
let bwAnimated = false, cliffAnimated = false;

// Intersection observer
const observer = new IntersectionObserver((entries) => {
  entries.forEach(e => {
    if(e.isIntersecting) {
      if(e.target.id === 'sec4' && !bwAnimated) {
        bwAnimated = true;
        barEls.forEach((id,i) => {
          setTimeout(() => {
            document.getElementById(id).style.height = barHeights[i] + 'px';
          }, i*200);
        });
      }
      if(e.target.id === 'sec5' && !cliffAnimated) {
        cliffAnimated = true;
        setTimeout(() => {
          document.getElementById('cliffBar1').style.height = '220px';
          document.getElementById('cliffBar2').style.height = '12px';
        }, 300);
      }
    }
  });
}, {threshold: 0.3});

// Navigation
const sections = document.querySelectorAll('section');
const navDots = document.getElementById('navDots');
sections.forEach((s,i) => {
  const dot = document.createElement('div');
  dot.className = 'nav-dot';
  dot.onclick = () => s.scrollIntoView({behavior:'smooth'});
  navDots.appendChild(dot);
  observer.observe(s);
});

window.addEventListener('scroll', () => {
  const scrollPct = window.scrollY / (document.body.scrollHeight - window.innerHeight);
  document.getElementById('progressBar').style.width = (scrollPct*100)+'%';

  const dots = document.querySelectorAll('.nav-dot');
  sections.forEach((s,i) => {
    const rect = s.getBoundingClientRect();
    if(rect.top < window.innerHeight/2 && rect.bottom > window.innerHeight/2) {
      dots.forEach(d => d.classList.remove('active'));
      dots[i].classList.add('active');
    }
  });
});
</script>
</body>
</html>
